---
pubDatetime: 2023-09-26T03:52:00Z
title: OSTEP 33 Event-based Concurrency
featured: false
tags:
  - OSTEP
  - Concurrency
  - Computer-Science
  - OS
ogImage: ""
description: OS:TEP 33장 공부한 거 정리
---

## Table of contents

## 들어가며

이제까지 쓰레드를 병행 프로그램을 제작하는 유일한 도구인 것처럼 말했다.
하지만 그렇지 않다.
특히, GUI 기반 프로그램이나 인터넷 서버에서는 다른 스타일의 병행 프로그래밍이 사용된다.
이런 스타일을 event-based concurrency이라 한다.
`node.js`와 같은 서버 프레임워크에서 사용되지만, 그 시작점은 지금부터 다룰 C와 유닉스 시스템이다.
이벤트 기반의 병행성은 두 개의 문제를 갖고 있다.

1. 멀티 쓰레드 프로그램에서 이벤트 기반 병행성을 올바르게 사용하는 것이 매우 어렵다. (락을 누락시키거나, 교착 상태 또는 다른 골치 아픈 문제들이 발생할 수 있기 때문이다.)
2. 멀티 쓰레드 프로그램에서는 개발자가 쓰레드 스케줄링에 대한 제어권을 전혀 갖고 있지 않다는 것이다. 개발자는 OS가 생성된 쓰레드를 CPU들 간에 합리적으로 스케줄링하기만을 기대할 수밖에 없다.

핵심 질문은 다음과 같다.

> **어떻게 쓰레드 없이 병행 서버를 개발할까?**
> 쓰레드 없이 병행 서버를 구현할 때, 어떻게 병행성을 유지하면서 각종 문제들을 피할 수 있을까?

## 기본 개념: 이벤트 루프

우리가 다룰 방법은 언급한 이벤트 기반 병행성이다.
이 접근 방법은 단순하다.
특정 사건 (즉, "이벤트") 의 발생을 대기한다.
사건이 발생하면, 사건 (즉, "이벤트") 의 종류를 파악한 후, I/O를 요청하거나, 추후 처리를 위하면 다른 이벤트를 발생시키거나 하는 등의 작업을 한다.
고전적인 이벤트 기반의 서버가 어떻게 생겼는지 살펴보자.
이 응용 프로그램은 event loop라는 단순한 구조를 기반으로 짜여 있다.
코드는 하기와 같다.
![](/public/image/ostep-33-event-based-concurrency-1695669194022.jpeg)

매우 간단하다.
루프 안에서 사건 발생을 대기한다.
이벤트가 발생하면 하나씩 처리한다.
이때 각 이벤트를 처리하는 코드를 이벤트 핸들러(event handler)라 부른다.
중요한 건 이벤트의 처리가 시스템의 유일한 작업이기 때문에, 다음에 처리할 이벤트를 결정하는 것이 스케줄링과 동일한 효과를 갖는다.
스케줄링을 제어할 수 있는 기능이 이벤트 기반 방법의 큰 장점이다.
큰 질문이 생긴다.

> **발생한 이벤트가 무슨 이벤트인지 어떻게 판단할까?**
