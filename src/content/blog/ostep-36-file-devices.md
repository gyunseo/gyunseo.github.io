---
title: OSTEP 36 File Devices
pubDatetime: 2023-10-09T22:05:00Z
featured: false
draft: false
tags:
  - OSTEP
  - file-devices
ogImage: ""
description: OSTEP 36장 공부한 거 정리
---

## Table of contents

## 들어가며

본론에 들어가기 전에 I/O device의 개념을 소개하고, OS가 이들과 상호 작용하는 방법을 알아 보자.  
당연하겠지만, I/O는 컴퓨터 시스템에서 상당히 중요한 부분이다.  
입력이 전혀 없는 프로그램이나 (늘 같은 결과를 출력하는), 출력이 없는 프로그램을 생각해 보라 (실행이 어떤 의미가 있겠는가?).  
컴퓨터 system을 유용하게 쓰려면 I/O 모두 필요하다는 것은 분명하다. 그러므로 우리가 해결해야 할 문제는 다음과 같다.

> 핵심 질문 : 어떻게 I/O를 시스템에 통합할까?
> 시스템에 I/O를 어떻게 통합해야 하는가? 일반적인 방법은 무엇인가? 어떻게 효율적으로 통합할 수 있을까?

## 시스템 구조

논의를 시작하기 위해 일단 하기 그림의 시스템 구조를 살펴 보자.  
하기 그림에서 CPU와 주메모리가 메모리 버스로 연결됐다.  
몇 가지 device들이 범용 I/O 버스에 연결돼 있는데, 많은 현대의 시스템에서는 PCI(또는 많은 파생 버스)를 사용하고 있다.  
그래픽이나 다른 고성능 I/O 장치들이 여기에 연결될 수 있다.  
마지막으로, 그 아래에는 SCSI나 SATA 또는 USB와 같은 주변장치용 버스가 있다.  
이 버스들을 통해 디스크, 마우스와 같은 가장 느린 장치들이 연결된다.  
![](/src/assets/image/ostep-36-file-devices-1696861239928.jpeg)
이런 계층적인 구조가 필요한 이유를 질문할 수 있는데, 간단하게 답하자면, 물리 학적인 이유와 비용 때문이다.  
버스가 고속화되려면 더 짧아져야 하는데, 그런 고속의 메모리 버스는 여러 장치들을 수용할 공간이 없다.  
또한, 고속의 성능을 내는 버스를 만드는 기술은 꽤나 비싸다.  
그렇기 때문에 시스템 설계자들은 계층적 구조를 택하여 (그래픽 카드와 같이) 고성능 장치들을 CPU에 가깝게 배치하였고 느린 성능의 장치들을 그보다 멀리 배치하였다.  
디스크처럼 느린 장치들을 주변 장치 I/O 버스에 연결하여 얻을 수 있는 이득은 많다.  
특히, 많은 장치들을 연결할 수 있다

## 표준 장치

이번에는 가상의 표준 장치를 살펴보고 이 장치를 효율적으로 활용하기 위해 필요한 것은 무엇인지를 알아 보자.  
하기 그림에서 나타낸 것과 같이 두 개의 중요한 요소가 있다.  
첫 번째는 시스템의 다른 구성 요소에게 제공하는 하드웨어 인터페이스이다.  
소프트웨어가 인터페이스를 제공하듯이, 하드웨어도 인터페이스를 제공하여 시스템 소프트웨어가 동작을 제어할 수 있도록 해야 한다.  
그렇기 때문에 모든 하드웨어 장치들은 특정한 상호 동작을 위한 방식과 명시적인 인터페이스를 갖고 있다.  
![](/src/assets/image/ostep-36-file-devices-1696863058869.jpeg)
장치가 갖고 있어야 하는 두 번째 요소는 내부 구조이다.  
구현 방법에 따라 다르지만 시스템에게 제공하는 장치에 대한 추상화를 정의하는 책임을 갖고 있다.  
매우 단순한 장치들은 하나 또는 몇 개의 하드웨어 칩을 사용하여 기능을 구현할 것이고 좀 더 복잡한 장치는 단순한 CPU와 범용 메모리 그리고 장치에 특화된 칩들을 사용하여 목적에 맞는 동작을 한다.  
최신 RAID 컨트롤러는 수십만 줄에 달하는 펌웨어(firmware)라는 소프트웨어가 하드웨어 내부의 동작을 정의하고 있다.

## 표준 방식

상기 그림에서 (단순화된) 장치의 인터페이스는 세 개의 레지스터로 구성되어 있는 것을 보았다.  
상태(status) 레지스터는 장치의 현재 상태를 읽을 수 있으며, 명령어(command) 레지스터는 장치가 특정 동작을 수행하도록 요청할 때, 그리고 데이터(data) 레지스터는 장치에 데이터를 보내거나 받거나 할 때 사용한다.  
이 레지스터들을 읽거나 쓰는 것을 통해 OS는 장치의 동작을 제어할 수 있다.  
이번에는 장치가 OS를 대신하여 특정 동작을 할 때에 운영체제와 장치 간에 일어날 수 있는 상호 동작의 과정을 살펴보자.  
이 경우 하기 그림과 같은 방식을 따른다.
![](/src/assets/image/ostep-36-file-devices-1696863392394.jpeg)
